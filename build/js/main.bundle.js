(()=>{"use strict";const e=document.querySelector("body"),t=document.querySelector("main"),n=document.querySelector(".effect-level__slider"),o=document.querySelector(".effect-level"),c=document.querySelector("#effect-none"),r=document.querySelector(".big-picture"),l=document.querySelector(".img-upload__overlay"),i=document.querySelector(".text__description"),s=document.querySelector(".text__hashtags"),a=document.querySelector(".scale__control--value"),d=document.querySelector(".img-upload__preview").querySelector("img"),u=document.querySelector(".scale__control--smaller"),m=document.querySelector(".scale__control--bigger"),y=document.querySelector("#upload-file"),f="#success",p=".success",v=function(e){return"Escape"===e.key},g=function(e,t){const n=document.createElement(e);return n.classList.add(t),n},S=function(){noUiSlider.create(n,{range:{min:0,max:1},start:0,step:.1,connect:"lower"})},h=function(t){v(t)&&(t.preventDefault(),window.removeEventListener("click",h),l.classList.add("hidden"),e.classList.remove("modal-open"),L())},q=function(t){v(t)&&(t.preventDefault(),window.removeEventListener("click",q),r.classList.add("hidden"),e.classList.remove("modal-open"))},L=function(){c.checked=!0,n.classList.contains("noUi-target")&&n.noUiSlider.destroy(),a.value="100%",d.style.transform="scale(1)",d.style.filter="none",d.src="",o.style.display="none",u.disabled=!1,m.disabled=!0,s.value="",i.value="",y.value=""},k=function(n,o){l.classList.add("hidden"),e.classList.remove("modal-open"),L();const c=document.createDocumentFragment(),r=document.querySelector(n).content.querySelector(o).cloneNode(!0);c.appendChild(r),t.appendChild(c);const i=document.querySelector(o),s=document.querySelector(o+"__inner"),a=document.querySelector(o+"__button"),d=()=>{L(),i.remove(),window.removeEventListener("keydown",u)},u=e=>{v(e)&&(e.preventDefault(),d())};a.addEventListener("click",d),window.addEventListener("keydown",u),i.addEventListener("click",(function(e){s.contains(e.target)||d()}))},b=document.querySelector(".social__comments"),E=document.querySelector(".big-picture"),w=document.querySelector(".big-picture__img").querySelector("img"),x=document.querySelector(".big-picture__cancel"),C=document.querySelector(".likes-count"),U=document.querySelector(".comments-count"),D=document.querySelector(".social__comments"),O=document.querySelector(".social__caption"),j=document.querySelector(".social__comment-count"),M=document.querySelector("body"),A=document.querySelector(".comments-loader");x.addEventListener("click",(function(){r.classList.add("hidden"),e.classList.remove("modal-open")})),window.addEventListener("keydown",q);const F=document.querySelector(".pictures"),T=document.querySelector("#picture").content.querySelector(".picture"),H=function(e){document.querySelectorAll(".picture").forEach((e=>e.remove()));const t=document.createDocumentFragment();e.forEach((({url:e,likes:n,comments:o})=>{const c=T.cloneNode(!0);c.querySelector(".picture__img").src=e,c.querySelector(".picture__comments").textContent=o.length,c.querySelector(".picture__likes").textContent=n,t.appendChild(c)})),F.appendChild(t),function(e){document.querySelectorAll(".picture").forEach(((t,n)=>{t.addEventListener("click",(()=>{E.classList.remove("hidden"),M.classList.add("modal-open"),D.innerHTML="";let t=5;const{url:o,likes:c,comments:r,description:l}=e[n];w.src=o,C.textContent=c,U.textContent=r.length,O.textContent=l;const i=function(){t+=5,j.textContent=t+" из "+r.length+" комментариев",s()},s=function(){D.innerHTML="",A.classList.remove("hidden"),j.textContent=t+" из "+r.length+" комментариев",r.length<=t&&(A.classList.add("hidden"),A.removeEventListener("click",i),j.textContent=r.length+" из "+r.length+" комментариев"),function(e,t){const n=document.createDocumentFragment();t.slice(0,e).forEach((e=>{const t=g("li","social__comment"),o=g("img","social__picture"),{avatar:c,name:r,message:l}=e;o.src=c,o.alt=r,t.appendChild(o);const i=g("p","social__text");i.textContent=l,t.appendChild(i),n.appendChild(t)})),b.appendChild(n)}(t,r)};s(),r.length>5&&A.addEventListener("click",i)}))}))}(e)},z=document.querySelector(".img-filters"),N=document.querySelector(".img-filters__form"),R=document.querySelector("#filter-default"),B=document.querySelector("#filter-random"),I=document.querySelector("#filter-discussed"),P=e=>e[function(e,t){if(e>t){let n=e;e=t,t=n}return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}(0,e.length-1)],V=document.querySelector(".img-upload__form"),W=document.querySelector("#upload-file"),$=document.querySelector("body"),G=document.querySelector(".img-upload__overlay"),J=document.querySelector("#upload-cancel"),K=document.querySelector(".img-upload__preview"),Q=K.querySelector("img"),X=["jpg","jpeg","png","gif"];document.addEventListener("dragover",(e=>e.preventDefault())),document.addEventListener("drop",(e=>e.preventDefault())),W.addEventListener("change",(function(e){e.preventDefault(),G.classList.remove("hidden"),$.classList.add("modal-open"),function(){let e=W.files[0];const t=e.name.toLowerCase();if(X.some((e=>t.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(function(){Q.src=t.result})),e?t.readAsDataURL(e):Q.src=""}}()})),J.addEventListener("click",(function(){l.classList.add("hidden"),e.classList.remove("modal-open"),L()})),window.addEventListener("keydown",h);const Y=document.querySelector(".scale__control--smaller"),Z=document.querySelector(".scale__control--bigger"),ee=document.querySelector(".scale__control--value");Y.addEventListener("click",(function(){(ee.value=ee.value.replace(/[%]/g,"")-25)<25?(ee.value=25,Y.disabled=!0):(Y.disabled=!1,Z.disabled=!1),Q.style.transform="scale(0."+ee.value+")",ee.value+="%"})),Z.addEventListener("click",(function(){(ee.value=+ee.value.replace(/[%]/g,"")+25)>100?(ee.value=100,Z.disabled=!0):Y.disabled=!1,ee.value<100?Q.style.transform="scale(0."+ee.value+")":Q.style.transform="scale(1)",ee.value+="%"}));const te=document.querySelector(".effect-level__slider"),ne=document.querySelector(".effect-level"),oe=document.querySelector(".effect-level__value"),ce=document.querySelector("#effect-none"),re=document.querySelector("#effect-chrome"),le=document.querySelector("#effect-sepia"),ie=document.querySelector("#effect-marvin"),se=document.querySelector("#effect-phobos"),ae=document.querySelector("#effect-heat");let de=K.querySelector("img");oe.value=0,ne.style.display="none";const ue=function(e,t){te.noUiSlider.on("update",((n,o,c)=>{oe.value=c[o],de.style.filter=e+"("+oe.value+t+")"}))};ce.addEventListener("change",(function(e){e.target.checked&&(de.style.filter="none",ne.style.display="none",oe.step="0.1",te.noUiSlider.destroy())})),re.addEventListener("change",(function(e){te.classList.contains("noUi-target")||S(),te.noUiSlider.updateOptions({range:{min:0,max:1},start:0,step:.1}),e.target.checked&&(te.noUiSlider.set(1),ne.style.display="block",de.style.filter="none",oe.step="0.1",ue("grayscale",""))})),le.addEventListener("change",(function(e){te.classList.contains("noUi-target")||S(),te.noUiSlider.updateOptions({range:{min:0,max:1},start:0,step:.1}),e.target.checked&&(te.noUiSlider.set(1),ne.style.display="block",de.style.filter="none",oe.step="0.1",ue("sepia",""))})),ie.addEventListener("change",(function(e){te.classList.contains("noUi-target")||S(),te.noUiSlider.updateOptions({range:{min:0,max:100},start:0,step:1}),e.target.checked&&(te.noUiSlider.set(100),ne.style.display="block",de.style.filter="none",oe.step="1",ue("invert","%"))})),se.addEventListener("change",(function(e){te.classList.contains("noUi-target")||S(),te.noUiSlider.updateOptions({range:{min:0,max:3},start:0,step:.1}),e.target.checked&&(te.noUiSlider.set(3),ne.style.display="block",de.style.filter="none",oe.step="0.1",ue("blur","px"))})),ae.addEventListener("change",(function(e){te.classList.contains("noUi-target")||S(),te.noUiSlider.updateOptions({range:{min:1,max:3},start:1,step:.1}),e.target.checked&&(te.noUiSlider.set(3),ne.style.display="block",de.style.filter="none",oe.step="0.1",ue("brightness",""))}));const me=document.querySelector(".text__hashtags"),ye=document.querySelector(".text__description");var fe;me.onfocus=function(){window.removeEventListener("keydown",h)},me.onblur=function(){window.addEventListener("keydown",h)},me.addEventListener("change",(function(){" "===me.value.slice(-1)?me.value=me.value.trim():me.setCustomValidity(function(e){let t="";const n=[],o=e.split(" ");return o.length>5&&n.push("Количество хэштегов не должно привышать 5"),function(e){const t=[];let n=!0;return e.forEach((e=>{const o=e.toLowerCase();t.includes(o)?n=!1:t.push(o)})),n}(o)||n.push("Хэштег не может повторяться"),o.forEach((e=>{t=function(e){let t="";return"#"!==e.slice(0,1)?t="Хэштег должен начинаться с решётки":(e=>/^\w+$/.test(e)&&!~e.indexOf("_"))(e.slice(1))?e.length>20&&(t="Хэштег не должен быть длиннее 20 символов (включая символ решётки)"):t="Хэштэг не должен содержать спецсимволы",t}(e),t&&n.push(t)})),t=n.join(", "),t}(me.value))})),ye.onfocus=function(){window.removeEventListener("keydown",h)},ye.onblur=function(){window.addEventListener("keydown",h)},fe=function(e){const t=document.createElement("div");t.style.zIndex=100,t.style.position="absolute",t.style.left=0,t.style.top=0,t.style.right=0,t.style.border="solid 2px red",t.style.fontSize="24px",t.style.lineHeight="30px",t.style.width="50%",t.style.minHeight="10%",t.style.backgroundColor="white",t.style.textAlign="center",t.style.paddingTop="10px",t.style.paddingBottom="10px",t.style.margin="0 auto",t.style.color="black",t.textContent=e,document.body.append(t),setTimeout((()=>{t.remove()}),5e3)},fetch("https://22.javascript.pages.academy/kekstagram/data").then((e=>{e.ok?e.json().then((e=>{H(e),function(e){z.classList.remove("img-filters--inactive"),N.addEventListener("click",_.debounce((t=>{if(!t.target.classList.contains("img-filters__button--active")){const e=document.querySelector(".img-filters__button--active");e&&(e.classList.remove("img-filters__button--active"),t.target.classList.add("img-filters__button--active"))}R.classList.contains("img-filters__button--active")?H(e):B.classList.contains("img-filters__button--active")?H(function(e){return((e,t)=>{if(e.length<=10)return e;const n=new Set;for(;n.size<10;)n.add(P(e));return Array.from(n)})(e)}(e)):I.classList.contains("img-filters__button--active")&&H(function(e){return e.slice().sort(((e,t)=>t.comments.length-e.comments.length))}(e))}),500))}(e)})):fe("Не удалось получить данные от сервера. Попробуйте перезагрузить страницу или зайти позже.")})).catch((()=>{fe("Не удалось получить данные от сервера. Попробуйте перезагрузить страницу или зайти позже.")})),V.addEventListener("submit",(function(e){e.preventDefault(),function(e,t,n){fetch("https://22.javascript.pages.academy/kekstagram",{method:"POST",body:n}).then((e=>{e.ok?k(f,p):t()})).catch((()=>{t()}))}(0,(()=>k("#error",".error")),new FormData(e.target))}))})();
//# sourceMappingURL=main.bundle.js.map