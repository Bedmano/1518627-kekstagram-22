(()=>{"use strict";const e=document.querySelector("body"),t=document.querySelector("main"),n=document.querySelector(".effect-level__slider"),o=document.querySelector(".effect-level"),c=document.querySelector("#effect-none"),r=document.querySelector(".big-picture"),l=document.querySelector(".img-upload__overlay"),i=document.querySelector(".text__description"),s=document.querySelector(".text__hashtags"),a=document.querySelector(".scale__control--value"),d=document.querySelector(".img-upload__preview").querySelector("img"),u=document.querySelector(".scale__control--smaller"),m=document.querySelector(".scale__control--bigger"),y=document.querySelector("#upload-file"),p="#success",f=".success",v=function(e){return"Escape"===e.key},g=function(e,t){const n=document.createElement(e);return n.classList.add(t),n},S=function(){noUiSlider.create(n,{range:{min:0,max:1},start:0,step:.1,connect:"lower"})},h=function(t){v(t)&&(t.preventDefault(),window.removeEventListener("click",h),l.classList.add("hidden"),e.classList.remove("modal-open"),L())},q=function(t){v(t)&&(t.preventDefault(),window.removeEventListener("click",q),r.classList.add("hidden"),e.classList.remove("modal-open"))},L=function(){c.checked=!0,n.classList.contains("noUi-target")&&n.noUiSlider.destroy(),a.value="100%",d.style.transform="scale(1)",d.style.filter="none",d.src="",o.style.display="none",u.disabled=!1,m.disabled=!0,s.value="",s.style.outline="",i.value="",y.value=""},k=function(n,o){l.classList.add("hidden"),e.classList.remove("modal-open"),L();const c=document.createDocumentFragment(),r=document.querySelector(n).content.querySelector(o).cloneNode(!0);c.appendChild(r),t.appendChild(c);const i=document.querySelector(o),s=document.querySelector(o+"__inner"),a=document.querySelector(o+"__button"),d=()=>{L(),i.remove(),window.removeEventListener("keydown",u)},u=e=>{v(e)&&(e.preventDefault(),d())};a.addEventListener("click",d),window.addEventListener("keydown",u),i.addEventListener("click",(function(e){s.contains(e.target)||d()}))},b=document.querySelector(".social__comments"),w=document.querySelector(".big-picture"),E=document.querySelector(".big-picture__img").querySelector("img"),x=document.querySelector(".big-picture__cancel"),C=document.querySelector(".likes-count"),U=document.querySelector(".comments-count"),D=document.querySelector(".social__comments"),V=document.querySelector(".social__caption"),O=document.querySelector(".social__comment-count"),A=document.querySelector("body"),M=document.querySelector(".comments-loader");x.addEventListener("click",(function(){r.classList.add("hidden"),e.classList.remove("modal-open")})),window.addEventListener("keydown",q);const j=document.querySelector(".pictures"),z=document.querySelector("#picture").content.querySelector(".picture"),F=function(e){document.querySelectorAll(".picture").forEach((e=>e.remove()));const t=document.createDocumentFragment();e.forEach((({url:e,likes:n,comments:o})=>{const c=z.cloneNode(!0);c.querySelector(".picture__img").src=e,c.querySelector(".picture__comments").textContent=o.length,c.querySelector(".picture__likes").textContent=n,t.appendChild(c)})),j.appendChild(t),function(e){document.querySelectorAll(".picture").forEach(((t,n)=>{t.addEventListener("click",(()=>{w.classList.remove("hidden"),A.classList.add("modal-open"),D.innerHTML="";let t=5;const{url:o,likes:c,comments:r,description:l}=e[n];E.src=o,C.textContent=c,U.textContent=r.length,V.textContent=l;const i=function(){t+=5,O.textContent=t+" из "+r.length+" комментариев",s()},s=function(){D.innerHTML="",M.classList.remove("hidden"),O.textContent=t+" из "+r.length+" комментариев",r.length<=t&&(M.classList.add("hidden"),M.removeEventListener("click",i),O.textContent=r.length+" из "+r.length+" комментариев"),function(e,t){const n=document.createDocumentFragment();t.slice(0,e).forEach((e=>{const t=g("li","social__comment"),o=g("img","social__picture"),{avatar:c,name:r,message:l}=e;o.src=c,o.alt=r,t.appendChild(o);const i=g("p","social__text");i.textContent=l,t.appendChild(i),n.appendChild(t)})),b.appendChild(n)}(t,r)};s(),r.length>5&&M.addEventListener("click",i)}))}))}(e)},T=document.querySelector(".img-filters"),H=document.querySelector(".img-filters__form"),N=document.querySelector("#filter-default"),R=document.querySelector("#filter-random"),$=document.querySelector("#filter-discussed"),B=e=>e[function(e,t){if(e>t){let n=e;e=t,t=n}return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}(0,e.length-1)],I=document.querySelector(".img-upload__form"),P=document.querySelector("#upload-file"),W=document.querySelector("body"),Z=document.querySelector(".img-upload__overlay"),G=document.querySelector("#upload-cancel"),J=document.querySelector(".img-upload__preview"),K=J.querySelector("img"),Q=["jpg","jpeg","png","gif"];document.addEventListener("dragover",(e=>e.preventDefault())),document.addEventListener("drop",(e=>e.preventDefault())),P.addEventListener("change",(function(e){e.preventDefault(),Z.classList.remove("hidden"),W.classList.add("modal-open"),function(){let e=P.files[0];const t=e.name.toLowerCase();if(Q.some((e=>t.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(function(){K.src=t.result})),e?t.readAsDataURL(e):K.src=""}}()})),G.addEventListener("click",(function(){l.classList.add("hidden"),e.classList.remove("modal-open"),L()})),window.addEventListener("keydown",h);const X=document.querySelector(".scale__control--smaller"),Y=document.querySelector(".scale__control--bigger"),ee=document.querySelector(".scale__control--value");X.addEventListener("click",(function(){(ee.value=ee.value.replace(/[%]/g,"")-25)<25?(ee.value=25,X.disabled=!0):(X.disabled=!1,Y.disabled=!1),K.style.transform="scale(0."+ee.value+")",ee.value+="%"})),Y.addEventListener("click",(function(){(ee.value=+ee.value.replace(/[%]/g,"")+25)>100?(ee.value=100,Y.disabled=!0):X.disabled=!1,ee.value<100?K.style.transform="scale(0."+ee.value+")":K.style.transform="scale(1)",ee.value+="%"}));const te=document.querySelector(".effect-level__slider"),ne=document.querySelector(".effect-level"),oe=document.querySelector(".effect-level__value"),ce=document.querySelector("#effect-none"),re=document.querySelector("#effect-chrome"),le=document.querySelector("#effect-sepia"),ie=document.querySelector("#effect-marvin"),se=document.querySelector("#effect-phobos"),ae=document.querySelector("#effect-heat");let de=J.querySelector("img");oe.value=0,ne.style.display="none";const ue=function(e,t){te.noUiSlider.on("update",((n,o,c)=>{oe.value=c[o],de.style.filter=e+"("+oe.value+t+")"}))};ce.addEventListener("change",(function(e){e.target.checked&&(de.style.filter="none",ne.style.display="none",oe.step="0.1",te.noUiSlider.destroy())})),re.addEventListener("change",(function(e){te.classList.contains("noUi-target")||S(),te.noUiSlider.updateOptions({range:{min:0,max:1},start:0,step:.1}),e.target.checked&&(te.noUiSlider.set(1),ne.style.display="block",de.style.filter="none",oe.step="0.1",ue("grayscale",""))})),le.addEventListener("change",(function(e){te.classList.contains("noUi-target")||S(),te.noUiSlider.updateOptions({range:{min:0,max:1},start:0,step:.1}),e.target.checked&&(te.noUiSlider.set(1),ne.style.display="block",de.style.filter="none",oe.step="0.1",ue("sepia",""))})),ie.addEventListener("change",(function(e){te.classList.contains("noUi-target")||S(),te.noUiSlider.updateOptions({range:{min:0,max:100},start:0,step:1}),e.target.checked&&(te.noUiSlider.set(100),ne.style.display="block",de.style.filter="none",oe.step="1",ue("invert","%"))})),se.addEventListener("change",(function(e){te.classList.contains("noUi-target")||S(),te.noUiSlider.updateOptions({range:{min:0,max:3},start:0,step:.1}),e.target.checked&&(te.noUiSlider.set(3),ne.style.display="block",de.style.filter="none",oe.step="0.1",ue("blur","px"))})),ae.addEventListener("change",(function(e){te.classList.contains("noUi-target")||S(),te.noUiSlider.updateOptions({range:{min:1,max:3},start:1,step:.1}),e.target.checked&&(te.noUiSlider.set(3),ne.style.display="block",de.style.filter="none",oe.step="0.1",ue("brightness",""))}));const me=document.querySelector(".text__hashtags"),ye=document.querySelector(".text__description"),pe=/^[0-9A-Za-zА-Яа-я]+$/,fe="red auto 1px";var ve;me.addEventListener("input",(()=>{const e=me.value.trim().toLowerCase().split(" ").filter((e=>e));""===me.value&&(me.style.outline="",me.setCustomValidity("")),e.some((t=>"#"!==t[0]?(me.setCustomValidity("хэш-тег должен начинаться с символа # (решётка)"),me.style.outline=fe,!0):e.length>5?(me.setCustomValidity("Допустимо использовать не более 5 хештегов"),me.style.outline=fe,!0):t.length<2?(me.setCustomValidity("хеш-тег не может состоять только из одной решётки"),me.style.outline=fe,!0):pe.test(t.slice(1))?t.length>20?(me.setCustomValidity("максимальная длина одного хэш-тега 20 символов, включая решётку"),me.style.outline=fe,!0):t.indexOf("#",1)>=1?(me.setCustomValidity("хэш-теги разделяются пробелами"),me.style.outline=fe,!0):e.length!==new Set(e).size?(me.setCustomValidity("один и тот же хэш-тег не может быть использован дважды"),me.style.outline=fe,!0):(me.setCustomValidity(""),void(me.style.outline="")):(me.style.outline=fe,me.setCustomValidity("строка после решётки должна состоять из букв и чисел и не может содержать пробелы, спецсимволы (#, @, $ и т. п.), символы пунктуации (тире, дефис, запятая и т. п.), эмодзи и т. д."),!0))),me.reportValidity()})),me.onfocus=function(){window.removeEventListener("keydown",h)},me.onblur=function(){window.addEventListener("keydown",h)},ye.onfocus=function(){window.removeEventListener("keydown",h)},ye.onblur=function(){window.addEventListener("keydown",h)},ve=function(e){const t=document.createElement("div");t.style.zIndex=100,t.style.position="absolute",t.style.left=0,t.style.top=0,t.style.right=0,t.style.border="solid 2px red",t.style.fontSize="24px",t.style.lineHeight="30px",t.style.width="50%",t.style.minHeight="10%",t.style.backgroundColor="white",t.style.textAlign="center",t.style.paddingTop="10px",t.style.paddingBottom="10px",t.style.margin="0 auto",t.style.color="black",t.textContent=e,document.body.append(t),setTimeout((()=>{t.remove()}),5e3)},fetch("https://22.javascript.pages.academy/kekstagram/data").then((e=>{e.ok?e.json().then((e=>{F(e),function(e){T.classList.remove("img-filters--inactive"),H.addEventListener("click",_.debounce((t=>{if(!t.target.classList.contains("img-filters__button--active")){const e=document.querySelector(".img-filters__button--active");e&&(e.classList.remove("img-filters__button--active"),t.target.classList.add("img-filters__button--active"))}N.classList.contains("img-filters__button--active")?F(e):R.classList.contains("img-filters__button--active")?F(function(e){return((e,t)=>{if(e.length<=10)return e;const n=new Set;for(;n.size<10;)n.add(B(e));return Array.from(n)})(e)}(e)):$.classList.contains("img-filters__button--active")&&F(function(e){return e.slice().sort(((e,t)=>t.comments.length-e.comments.length))}(e))}),500))}(e)})):ve("Не удалось получить данные от сервера. Попробуйте перезагрузить страницу или зайти позже.")})).catch((()=>{ve("Не удалось получить данные от сервера. Попробуйте перезагрузить страницу или зайти позже.")})),I.addEventListener("submit",(function(e){e.preventDefault(),function(e,t,n){fetch("https://22.javascript.pages.academy/kekstagram",{method:"POST",body:n}).then((e=>{e.ok?k(p,f):t()})).catch((()=>{t()}))}(0,(()=>k("#error",".error")),new FormData(e.target))}))})();
//# sourceMappingURL=main.bundle.js.map