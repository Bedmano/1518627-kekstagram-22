(()=>{"use strict";const e=document.querySelector("body"),t=document.querySelector("main"),n=document.querySelector(".effect-level__slider"),o=document.querySelector("#effect-none"),c=document.querySelector(".big-picture"),r=document.querySelector(".img-upload__overlay"),i=document.querySelector(".text__description"),s=document.querySelector(".text__hashtags"),l=document.querySelector(".scale__control--value"),a=document.querySelector(".img-upload__preview").querySelector("img"),u=document.querySelector(".scale__control--smaller"),d=document.querySelector(".scale__control--bigger"),m="#success",f=".success",y=function(e){return"Escape"===e.key},p=function(e,t){const n=document.createElement(e);return n.classList.add(t),n},g=function(){noUiSlider.create(n,{range:{min:0,max:1},start:0,step:.1,connect:"lower"})},v=function(){r.classList.add("hidden"),e.classList.remove("modal-open"),S()},h=function(t){y(t)&&(t.preventDefault(),r.classList.add("hidden"),e.classList.remove("modal-open"),S())},S=function(){o.checked=!0,n.classList.contains("noUi-target")&&n.noUiSlider.destroy(),l.value="100%",a.style.transform="scale(1)",a.style.filter="none",a.src="",u.disabled=!1,d.disabled=!0,s.value="",i.value=""},q=function(e,n){v();const o=document.createDocumentFragment(),c=document.querySelector(e).content.querySelector(n).cloneNode(!0);o.appendChild(c),t.appendChild(o);const r=document.querySelector(n),i=document.querySelector(n+"__inner");document.querySelector(n+"__button").addEventListener("click",(function(){S(),r.remove()})),window.addEventListener("keydown",(function(e){y(e)&&(e.preventDefault(),S(),r.remove())})),r.addEventListener("click",(function(e){i.contains(e.target)||(S(),r.remove())}))},L=document.querySelector(".social__comments"),b=document.querySelector(".big-picture"),E=document.querySelector(".big-picture__img").querySelector("img"),k=document.querySelector(".big-picture__cancel"),w=document.querySelector(".likes-count"),x=document.querySelector(".comments-count"),C=document.querySelector(".social__comments"),U=document.querySelector(".social__caption"),D=document.querySelector(".social__comment-count"),A=document.querySelector("body"),O=document.querySelector(".comments-loader");k.addEventListener("click",(function(){c.classList.add("hidden"),e.classList.remove("modal-open")})),window.addEventListener("keydown",(function(t){y(t)&&(t.preventDefault(),c.classList.add("hidden"),e.classList.remove("modal-open"))}));const j=document.querySelector(".pictures"),M=document.querySelector("#picture").content.querySelector(".picture"),F=function(e){document.querySelectorAll(".picture").forEach((e=>e.remove()));const t=document.createDocumentFragment();e.forEach((({url:e,likes:n,comments:o})=>{const c=M.cloneNode(!0);c.querySelector(".picture__img").src=e,c.querySelector(".picture__comments").textContent=o.length,c.querySelector(".picture__likes").textContent=n,t.appendChild(c)})),j.appendChild(t),function(e){document.querySelectorAll(".picture").forEach(((t,n)=>{t.addEventListener("click",(()=>{b.classList.remove("hidden"),A.classList.add("modal-open"),C.innerHTML="";let t=5;const{url:o,likes:c,comments:r,description:i}=e[n];E.src=o,w.textContent=c,x.textContent=r.length,U.textContent=i;const s=function(){t+=5,D.textContent=t+" из "+r.length+" комментариев",l()},l=function(){C.innerHTML="",O.classList.remove("hidden"),D.textContent=t+" из "+r.length+" комментариев",r.length<=t&&(O.classList.add("hidden"),O.removeEventListener("click",s),D.textContent=r.length+" из "+r.length+" комментариев"),function(e,t){const n=document.createDocumentFragment();t.slice(0,e).forEach((e=>{const t=p("li","social__comment"),o=p("img","social__picture"),{avatar:c,name:r,message:i}=e;o.src=c,o.alt=r,t.appendChild(o);const s=p("p","social__text");s.textContent=i,t.appendChild(s),n.appendChild(t)})),L.appendChild(n)}(t,r)};l(),r.length>5&&O.addEventListener("click",s)}))}))}(e)},T=document.querySelector(".img-filters"),H=document.querySelector(".img-filters__form"),z=document.querySelector("#filter-default"),N=document.querySelector("#filter-random"),R=document.querySelector("#filter-discussed"),B=e=>e[function(e,t){if(e>t){let n=e;e=t,t=n}return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}(0,e.length-1)],I=document.querySelector(".img-upload__form"),P=document.querySelector("#upload-file"),V=document.querySelector("body"),W=document.querySelector(".img-upload__overlay"),$=document.querySelector("#upload-cancel"),G=document.querySelector(".img-upload__preview"),J=G.querySelector("img"),K=["jpg","jpeg","png","gif"];document.addEventListener("dragover",(e=>e.preventDefault())),document.addEventListener("drop",(e=>e.preventDefault())),P.addEventListener("change",(function(e){e.preventDefault(),W.classList.remove("hidden"),V.classList.add("modal-open"),function(){let e=P.files[0];const t=e.name.toLowerCase();if(K.some((e=>t.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(function(){J.src=t.result})),e?t.readAsDataURL(e):J.src=""}}(),P.value=""})),$.addEventListener("click",v),window.addEventListener("keydown",h);const Q=document.querySelector(".scale__control--smaller"),X=document.querySelector(".scale__control--bigger"),Y=document.querySelector(".scale__control--value");Q.addEventListener("click",(function(){(Y.value=Y.value.replace(/[%]/g,"")-25)<25?(Y.value=25,Q.disabled=!0):(Q.disabled=!1,X.disabled=!1),J.style.transform="scale(0."+Y.value+")",Y.value+="%"})),X.addEventListener("click",(function(){(Y.value=+Y.value.replace(/[%]/g,"")+25)>100?(Y.value=100,X.disabled=!0):Q.disabled=!1,Y.value<100?J.style.transform="scale(0."+Y.value+")":J.style.transform="scale(1)",Y.value+="%"}));const Z=document.querySelector(".effect-level__slider"),ee=document.querySelector(".effect-level__value"),te=document.querySelector("#effect-none"),ne=document.querySelector("#effect-chrome"),oe=document.querySelector("#effect-sepia"),ce=document.querySelector("#effect-marvin"),re=document.querySelector("#effect-phobos"),ie=document.querySelector("#effect-heat");let se=G.querySelector("img");ee.value=0;const le=function(e,t){Z.noUiSlider.on("update",((n,o,c)=>{ee.value=c[o],se.style.filter=e+"("+ee.value+t+")"}))};te.addEventListener("change",(function(e){e.target.checked&&(se.style.filter="none",ee.setAttribute("step","0.1"),Z.noUiSlider.destroy())})),ne.addEventListener("change",(function(e){Z.classList.contains("noUi-target")||g(),Z.noUiSlider.updateOptions({range:{min:0,max:1},start:0,step:.1}),e.target.checked&&(Z.noUiSlider.set(0),se.style.filter="none",ee.setAttribute("step","0.1"),le("grayscale",""))})),oe.addEventListener("change",(function(e){Z.classList.contains("noUi-target")||g(),Z.noUiSlider.updateOptions({range:{min:0,max:1},start:0,step:.1}),e.target.checked&&(Z.noUiSlider.set(0),se.style.filter="none",ee.setAttribute("step","0.1"),le("sepia",""))})),ce.addEventListener("change",(function(e){Z.classList.contains("noUi-target")||g(),Z.noUiSlider.updateOptions({range:{min:0,max:100},start:0,step:1}),e.target.checked&&(Z.noUiSlider.set(0),se.style.filter="none",ee.setAttribute("step","1"),le("invert","%"))})),re.addEventListener("change",(function(e){Z.classList.contains("noUi-target")||g(),Z.noUiSlider.updateOptions({range:{min:0,max:3},start:0,step:.1}),e.target.checked&&(Z.noUiSlider.set(0),se.style.filter="none",ee.setAttribute("step","0.1"),le("blur","px"))})),ie.addEventListener("change",(function(e){Z.classList.contains("noUi-target")||g(),Z.noUiSlider.updateOptions({range:{min:1,max:3},start:1,step:.1}),e.target.checked&&(Z.noUiSlider.set(1),se.style.filter="none",ee.setAttribute("step","0.1"),le("brightness",""))}));const ae=document.querySelector(".text__hashtags"),ue=document.querySelector(".text__description");var de;ae.onfocus=function(){window.removeEventListener("keydown",h)},ae.onblur=function(){window.addEventListener("keydown",h)},ae.addEventListener("change",(function(){" "===ae.value.slice(-1)?ae.value=ae.value.trim():ae.setCustomValidity(function(e){let t="";const n=[],o=e.split(" ");return o.length>5&&n.push("Количество хэштегов не должно привышать 5"),function(e){const t=[];let n=!0;return e.forEach((e=>{const o=e.toLowerCase();t.includes(o)?n=!1:t.push(o)})),n}(o)||n.push("Хэштег не может повторяться"),o.forEach((e=>{t=function(e){let t="";return"#"!==e.slice(0,1)?t="Хэштег должен начинаться с решётки":(e=>/^\w+$/.test(e)&&!~e.indexOf("_"))(e.slice(1))?e.length>20&&(t="Хэштег не должен быть длиннее 20 символов (включая символ решётки)"):t="Хэштэг не должен содержать спецсимволы",t}(e),t&&n.push(t)})),t=n.join(", "),t}(ae.value))})),ue.onfocus=function(){window.removeEventListener("keydown",h)},ue.onblur=function(){window.addEventListener("keydown",h)},de=function(e){const t=document.createElement("div");t.style.zIndex=100,t.style.position="absolute",t.style.left=0,t.style.top=0,t.style.right=0,t.style.border="solid 2px red",t.style.fontSize="24px",t.style.lineHeight="30px",t.style.width="50%",t.style.minHeight="10%",t.style.backgroundColor="white",t.style.textAlign="center",t.style.paddingTop="10px",t.style.paddingBottom="10px",t.style.margin="0 auto",t.style.color="black",t.textContent=e,document.body.append(t),setTimeout((()=>{t.remove()}),5e3)},fetch("https://22.javascript.pages.academy/kekstagram/data").then((e=>{e.ok?e.json().then((e=>{F(e),function(e){T.classList.remove("img-filters--inactive"),H.addEventListener("click",_.debounce((t=>{if(!t.target.classList.contains("img-filters__button--active")){const e=document.querySelector(".img-filters__button--active");e&&(e.classList.remove("img-filters__button--active"),t.target.classList.add("img-filters__button--active"))}z.classList.contains("img-filters__button--active")?F(e):N.classList.contains("img-filters__button--active")?F(function(e){return((e,t)=>{if(e.length<=10)return e;const n=new Set;for(;n.size<10;)n.add(B(e));return Array.from(n)})(e)}(e)):R.classList.contains("img-filters__button--active")&&F(function(e){return e.slice().sort(((e,t)=>t.comments.length-e.comments.length))}(e))}),500))}(e)})):de("Не удалось получить данные от сервера. Попробуйте перезагрузить страницу или зайти позже.")})).catch((()=>{de("Не удалось получить данные от сервера. Попробуйте перезагрузить страницу или зайти позже.")})),I.addEventListener("submit",(function(e){e.preventDefault(),function(e,t,n){fetch("https://22.javascript.pages.academy/kekstagram",{method:"POST",body:n}).then((e=>{e.ok?q(m,f):t()})).catch((()=>{t()}))}(0,(()=>q("#error",".error")),new FormData(e.target))}))})();
//# sourceMappingURL=main.bundle.js.map